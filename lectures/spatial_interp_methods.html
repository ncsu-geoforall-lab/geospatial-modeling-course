<section>
    <h2><b>Spatial Interpolation: Methods</b></h2>
    <p style="margin-top: 0.5em">
        Helena Mitasova</p>
    <p class="title-foot">
        GIS/MEA582 Geospatial Modeling and Analysis
        <a href="http://www.ncsu.edu/" title="North Carolina State University">NCSU</a>
    </p>
</section>

<section>
    <h3>Learning objectives</h3>
<p>
<ul>
 <li>define spatial interpolation and its applications
 <li>classify methods and their properties
 <li>explain Voronoi polygons and linear interpolation on triangular irregular network
 <li>explain and apply inverse distance weighted method 
 <li>define geostatistical approach
 <li>define radial basis functions and splines 
</ul>
</section>

<section>
  <h3>Spatial interpolation</h3>
Estimate values at unsampled points using values measured at given points to:
<p>
<ul>
<li class="fragment">convert 2D, 3D scattered points, profiles, isolines to raster: gridding
<li class="fragment">resample 2D, 3D raster data to higher resolution
<li class="fragment">compute denser or smoother mesh representation
</ul>
</section>

<section>
  <h3>Scattered points to raster</h3>
Most common application 
<p><img height="240" src="img/spatial_interpolation/scattered_pts.jpg">
<img height="240" src="img/spatial_interpolation/pointstogrid.jpg">
</section>

<section>
   <h3>Bi-variate interpolation</h3>
<p>
From given $(x,y,z)$ scattered points to 2D grid: surface
<p>
 <img height="250" src="img/lidarmrpts3dcolored.jpg">
 <img height="250" src="img/nvizcutplanelwDEMDSMS.jpg">
</p>
</section>

<section>
  <h3>Tri-variate interpolation</h3>
From given $(x,y,z,w)$ scattered points to 3D grid: volume
<p>
<img height="360" src="img/spatial_interpolation/soilpts.gif">
<img height="370" src="img/spatial_interpolation/clayfenc.gif">
<p class="fragment"><small>Soil properties: clay content</small>
</section>

<section>
  <h3>Quad-variate interpolation</h3>
From given $(x,y,z,t,w)$ scattered points in space and time to 4D grid: time series of volumes
<p class="fragment"> <img height="350" src="img/data_visualize/wellnew.gif">
<p class="fragment"><small>Sampling points of groundwater pollution in space and time (10 years)</small>
</section>

<section>
  <h3>Quad-variate interpolation</h3>
Groundwater pollution over 10 years: 3D space + time
<p class="fragment"> <img height="400" src="img/data_visualize/well456.gif">
</p>
</section>

<section>
   <h3>Spatial interpolation: foundations</h3>
<p>
Problem definition 
<ul>
<li class="fragment">find a function which passes through (or close to) the given set of discrete points and then
<p>
<li class="fragment">use this function to estimate the values at unsampled points – usually a regular grid
</ul>
</section>

<section>
   <h3>Scattered points to raster</h3>
<p>
Find mathematical function to estimate values at regular grid using values at the given scattered points
<p> <img height="350" src="img/spatial_interpolation/scattered_pts.jpg">
 <img height="350" src="img/spatial_interpolation/pointstogrid.jpg">
</p>
</section>

<section>
   <h3>Mathematical formulation</h3>
Bi-variate interpolation and approximation can be formulated as follows:
<p>
Given $m$-points $(x_i, y_i, z_i), i=1,m$ 
<br>find such $F(x,y)$ that for each $i=1,m$
<p class="fragment">
           $$z_i=F(x_i,y_i)$$   
<p  class="fragment">
and compute $z_k=F(x_k,y_k)$ where $(x_k,y_k)$ are grid points
<p class="fragment">
<b>Why is this a difficult problem?</b>
</section>

<!-- introduce approximation later
<section>
   <h3>Mathematical formulation</h3>
Bi-variate interpolation and approximation can be formulated as follows:
<p>
Given $m$-points $(x_i, y_i, z_i), i=1,m$ 
<br>find such $F(x,y)$ that for each $i=1,m$
<p class="fragment">
           $$z_i=F(x_i,y_i)$$  
           $$z_i=F(x_i,y_i) + e(x_i,y_i)$$
<p  class="fragment">
and compute $z_k=F(x_k,y_k)$ where $(x_k,y_k)$ are grid points
<p class="fragment">
<b>Why is this a difficult problem?</b>
</section>
-->

<section>
   <h3>Interpolation problem solution</h3>
Problem does not have a unique solution: 
<p> 
<img height="350" src="img/spatial_interpolation/interp1d_nn.png"> </p>
</section>

<section>
   <h3>Interpolation problem solution</h3>
Problem does not have a unique solution:
<p>
<img height="350" src="img/spatial_interpolation/interp1d_lin.png"> </p>
</section>

<section>
   <h3>Interpolation problem solution</h3>
Problem does not have a unique solution:
<p>
<img height="350" src="img/spatial_interpolation/interp1d_curve.png"> </p>
</section>

<section>
   <h3>Interpolation problem solution</h3>
Additional conditions are needed
<p>
<img height="350" src="img/spatial_interpolation/interp1d_all.png"> </p>
</section>

<section>
   <h3>Interpolation conditions</h3>
<p>
<ul>
  <li class="fragment"><b>Locality </b>: each point influences the surface only up to certain distance
   or value at a given point will be similar to values at nearby points
<p>
   <li class="fragment"><b>Geostatistical</b>: surface is one realization of a random function with spatial covariance 
<p>
   <li class="fragment"><b>Smoothness</b> surface should be as smooth as possible while passing through or close to the data points
</ul>
<!--<p class="credit">(note: default color ramp for FP maps is often greyscale with uniform interval)</p>-->
</section>

<section>
   <h3>Interpolation general equation</h3>
Spatial interpolation function $F(r)$ can be expressed as:
<p>
$$
F(r) = T(r) + ∑ λ_j R(r,r_j)  \;    j=1,m
$$
<ul>
<li class="fragment"> $r = (x,y)$ is location of an unsampled point (e.g. grid point), 
<li class="fragment">$r_j=(x_j,y_j$) is location of a measured point
<li class="fragment">$T(r)$ is trend (low order polynomial), 
<li class="fragment">$λ_j$ are coefficients 
<li class="fragment">$R(r,r_j)$ is a function of distance between the points (radial basis function, model variogram)
</ul>
</section>

<section>
   <h3>Local interpolation methods</h3>
<p>
Only a small subset of $n$ neighboring points is used
<p>
<ul>
 <li class="fragment">Voronoi polygons 
 <li class="fragment">Triangular Irregular Network (TIN) - based linear interpolation
 <li class="fragment">Inverse distance weighted method
</ul>
</section>

<section>
   <h3>Voronoi (Thiessen)  polygons</h3>
Voronoi polygon edges are equidistant to 2 given points, 
define <b>unique nearest neighborhood</b> around each point
<p>
<img height="330" src="img/spatial_interpolation/voronoi_tin_zm.png"> </p>
<p>Voronoi polygons (red) are derived from the measured data - the measured point (blue)
 is at the center of a Voronoi polygon 
<p><small><a href="http://alexbeutel.com/webgl/voronoi.html"> Voronoi diagram generator</a>
or <a href="https://websvg.github.io/voronoi/">Parametric Voronoi generator</a></small>
</section>

<section>
   <h3>Voronoi (Thiessen)  polygons</h3>
<p>
Value at an unsampled point $z(x,y)$ is <b>the same</b> as the measured value $z(x_j,y_j)$
at the center of the Voronoi polygon $V_j$ within which the unsampled point is located:
<p class="fragment">
$$ T(x,y) = 0 $$
$$z(x,y) = λ z(x_j,y_j)$$ 
<p class="fragment">
<ul>
<li class="fragment">$\lambda = 1$, if $(x,y)$ is within $V_j$  
<li class="fragment">$\lambda = 0$, if $(x,y)$ is outside $V_j$
<li class="fragment">$j = 1,m$, where $m$ is the number of given points
</ul>
</section>

<section>
   <h3>Voronoi polygons</h3>
<ul>
 <li>2m resolution DEM computed using Voronoi polygons:
  <li>includes only measured values and the surface is not continuous 
</ul>
<p>
<img height="380" src="img/spatial_interpolation/IntF1a.gif"> </p>
</section>

<section>
   <h3>Linear TIN-based method</h3>
<p>
Value $z(x,y)$ at an unsampled point is a linear combination of values 
at 3 nearby given points $z(x_j,y_j)$ that form vertices of a triangle
<p class="fragment">
$$ T(r) = 0 $$
$$z(x,y) = {∑ \lambda_j z(x_j,y_j)} \over {\lambda_T} \quad  j=1,2,3$$
<ul>
<li class="fragment">$\lambda_j$ is weight proportional to the area of a triangle 
defined by the unsampled point and two given points
<li class="fragment">$\lambda_T$ is is weight proportional to the area of a triangle
defined by the measured points
</ul>
</section>

<section>
   <h3>Delaunay triangulation</h3>
<p>
Delaunay triangulation for a set of points P in a plane fulfills 
the condition that no point in P is inside the circumcircle of any triangle in DT(P).
<p>
<img height="380" src="img/spatial_interpolation/DelaunayTIN1.png"> </p>
</section>

<section>
   <h3>Delaunay triangulation</h3>
<p>
Delaunay triangulation for a set of points P in a plane fulfills 
the condition that no point in P is inside the circumcircle of any triangle in DT(P).
<p>
<img height="380" src="img/spatial_interpolation/DelaunayTIN2.png"> </p>
<p><small>Learn more about  
<a href="https://en.wikipedia.org/wiki/Delaunay_triangulation">properties and algorithms</a>
</section>

<section>
   <h3>Delaunay TIN and Voronoi polygons</h3>
<p>
Voronoi (Thiessen) polygons and Delaunay triangulation create dual graphs. 
<p>
<img height="380" src="img/spatial_interpolation/DelaunayTIN_Voronoi.png"> </p>
<p><small>Each face of VP is associated with a TIN vertex and each TIN face has a VP vertex associated with it</small>
</section>

<section>
   <h3>Delaunay TIN</h3>
<p>
Delaunay triangulation of sample elevation data 
<p>
<img height="400" src="img/spatial_interpolation/tin2dstream.png"> </p>
</section>

<section>
   <h3>Linear TIN-based method</h3>
<ul>
 <li>2m res. DEM computed using linear interpolation on TIN
  <li>includes measured and interpolated values
  <li>surface is continuous, but the derivatives are not
</ul>
<p>
<img height="380" src="img/spatial_interpolation/IntTinF1b.gif"> </p>
</section>

<section>
   <h3>Linear isoline-based method</h3>
<ul>
 <li>given points along isolines, unsampled points on grid
 <li>linear interpolation along steepest slope lines between two neighboring isolines
</ul>
<p>
<img height="300" src="img/spatial_interpolation/contour_interp.jpg"> </p>
<img height="380" src="img/spatial_interpolation/interp_lin_isolines.jpg"> </p>
</section>

<section>
   <h3>Inverse distance weighted method</h3>
<p>
Inverse Distance Weighted Interpolation (IDW):
<ul>
<li class="fragment">the simplest and most common method
<li class="fragment">value at an unsampled point is a weighted average of  values at nearby measured points 
<li class="fragment">weights are usually inverse distance squared
<li class="fragment">nearby measured points are defined as those located within a given distance or the closest n-points
<li class="fragment">many modifications and improvements were developed 
</ul>
</section>

<section>
   <h3>Inverse distance weighted method</h3>
<p>
Value at a unsampled grid point is a weighted average of values measured at $n$ nearby points:

$$ T(x,y) = 0 $$
<p>
$$z(x,y) = ∑ \lambda_j z(x_j,y_j) / ∑ \lambda_j \quad  j=1,..., n$$

<ul>
 <li class="fragment"> $\lambda_j = 1/d_j^p$ is weight proportional to power of distance between 
      the measured point $(x_j,y_j)$ and unsampled point $(x,y)$, 
 <li class="fragment"> $p$ is exponent, usually $p=2$
 <li class="fragment">function passes through the data points
 <li class="fragment">smoothing can be introduced by setting the weights as  $\lambda_j = 1/ (d_j^p + \beta)$, 
     where $\beta$ is a smoothing parameter
</ul>
</section>

<section>
   <h3>Inverse distance weighted method</h3>
<p>
Value at a unsampled grid point (blue) is a weighted average of values measured at $n$ nearby points (black):
$$z(x,y) = ∑ \lambda_j z(x_j,y_j) / ∑ \lambda_j \quad  j=1,..., n$$
<p>
<img height="380" src="img/spatial_interpolation/idw_pointselect.png"> </p>
</section>

<section>
   <h3>Inverse distance weighted method</h3>
2m resolution DEM computed from points that are ~50m appart:
leads to local peaks and pits around given points
<p>
<img height="380" src="img/spatial_interpolation/IntIDWF1c.gif"> </p>
<p><small>bull's eye effect – circular contours when distance between 
the measured points is much larger than the distance between grid points</small>
</section>

<section>
   <h3>Inverse distance weighted method</h3>
Impact of power parameter (p=0.5, 2, 5) on the resulting surface: precipitation in NC
<p>
<img height="480" src="img/spatial_interpolation/idw_precip_contours2d.png"> </p>
</section>

<section>
   <h3>Inverse distance weighted method</h3>
Surfaces with power exponent p=0.5 and p=5
<p>
<img height="220" src="img/spatial_interpolation/idw_precip_p05_3dpts.png"> </p>
<img height="220" src="img/spatial_interpolation/idw_precip_p5_3d_pts.jpg"> </p>
<p><small>Method works well when density of given points is close to the resulting resolution,
otherwise it can lead to surface artifacts</small>
</section>

<section>
   <h3>Geostatistical approach to interpolation</h3>
<ul>
<li class="fragment">surface is one realization of a random function with spatial covariance
<li class="fragment">the function is given by model variogram (best fit of the empirical variogram)
<li class="fragment">universal kriging includes trend term
<li class="fragment">implemented as global or local function
</ul>
</section>

<section>
   <h3>Geostatistical approach to interpolation</h3>
General equation
<p>
$$
F(r) = T(r) + ∑ λ_j R(r,r_j)  \;    j=1,m
$$
<ul>
<li class="fragment"> $r = (x,y)$ is location of a unsampled grid point,
<li class="fragment">$r_j=(x_j,y_j$) is location of a measured point
<li class="fragment">$T(r)$ is trend (low order polynomial),
<li class="fragment">$λ_j$ are coefficients
<li class="fragment">$R(r,r_j)$ is a model variogram (function of distance between unsampled and measured point)
</ul>
The coefficients $λ_j$ are found by solving system of $m$ linear equations
</section>

<section>
   <h3>Geostatistical approach</h3>
We assume that the points that are close to each other have smaller differences in measured values 
than the points that are farther appart 
<p>
<ul>
<li class="fragment">Model variogram $R(r,r_j)$ is derived by fitting a suitable function to empirical variogram 
<li class="fragment">empirical variogram is derived from data as
$$
\gamma (h) = (1/m_h) ∑[z(r_i) - z(r_j)]^2 \;  i=1,…, m_h
$$
<small>which is mean difference in measured values $z$ for points that are separated 
by a distance $h$ (with some tolerance defining the size of histogram bin)
</small>
<p>
Many model functions can be used: spherical, exponential, Gaussian, … 
</section>

<section>
   <h3>Model variogram</h3>
<p>Terms: sill - semivariogram at infinity, nugget - semivariogram at 0, range - distance to sill
<p>(from Geostat_ITCCov3.pdf, D.G. Rossiter)
</section>

<section>
   <h3>Kriging</h3>
One of possible results from kriging, roughness in the surface is due to local implementation, 
discussed in the next section, not the function itself
<p>
<img height="380" src="img/spatial_interpolation/IntkrigF1d.gif"> </p>
</section>

<section>
   <h3>Splines</h3>
<p>
<img height="250" src="img/spatial_interpolation/InttopogrF1e.gif"> 
<img height="250" src="img/spatial_interpolation/IntRSTF1f.gif"> 
</section>

<section>
   <h3>Summary</h3>
Can you guess the interpolation method?
<p>
<img height="450" src="img/interpolationBW.jpg"> </p>
</section>

<section>
   <h3>Summary</h3>
<ul>
<li class="fragment">Instead of a single universal solution that would automatically optimize its parameters to the given data set and application we now have a large number of different interpolation and approximation methods and their implementations and no robust automated approach for choosing the right one
<li class="fragment">Sound knowledge of interpolated phenomenon and the methods is needed to do it correctly
<li class="fragment">But – if there is sufficient amount of uniformly distributed data, most methods will provide good results 
<li class="fragment">Keep interpolation in mind when collecting data (e.g. parallel far apart but densely sampled profiles are difficult to interpolate)
</ul>

</section>

<div class="parent-page">
    <!-- &#x1f3e0; -->
    <a href="http://ncsu-geoforall-lab.github.io/geospatial-modeling-course/" title="Go to the course page">&#8962;</a>
</div>
