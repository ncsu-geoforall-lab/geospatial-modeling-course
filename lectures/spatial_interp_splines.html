<section>
    <h2><b>Spatial Interpolation: Splines</b></h2>
    <p style="margin-top: 0.5em">
        Helena Mitasova</p>
    <p class="title-foot">
        GIS/MEA582 Geospatial Modeling and Analysis
        <a href="http://www.ncsu.edu/" title="North Carolina State University">NCSU</a>
    </p>
</section>

<section>
    <h3>Outline (learning objectives)</h3>
<p>
<ul>
  <li>Spline interpolation 
  <li>Spline parameters: tension and smoothing
  <li>Evaluating interpolation accuracy: deviations, crossvalidation
  <li>Special cases: contours, anisotropy 
  <li>Trivariate interpolation of volumes and topo-climatology
  <li>Selection of points and segmentation 
</ul>
</section>

<section>
  <h3>Interpolation with radial basis functions</h3>
<p>Variational approach is based on minimizing:
<ul>
  <li class="fragment">deviations from the given points
  <li class="fragment">smoothness seminorm or roughness penalty
</ul>
<p class="fragment">
Physics-based interpretation:  spline interpolation function is a thin flexible plate with tunable bending energy
<p class="fragment">
Formally equivalent to universal kriging
<p class="fragment">
Radial basis functions: multiquadrics, splines
</section>

<section>
   <h3>Splines: general equation</h3>
<p>
$$
F(r) = T(r) + ∑ λ_j R(r,r_j)  \;    j=1,m
$$
<ul>
<li> $r = (x,y)$ is location of a grid point,
<li>$r_j=(x_j,y_j$) is location of a measured point
<li>$T(r)$ is trend (low order polynomial),
<li>$λ_j$ are coefficients
<li>$R(r,r_j)$ is a radial basis function
</ul>
</section>

<section>
  <h3>Splines with different properties</h3>
  <p>Spline properties depend on the formulation of
smoothness seminorm or roughness penalty
<ul>
  <li class="fragment">thin plate spline
  <li class="fragment">spline with tension 
  <li class="fragment">regularized spline
  <li class="fragment">regularized spline with tension (completely regularized spline)
  <li class="fragment">see the smoothness seminorms in 
  <a href="http://fatra.cnr.ncsu.edu/geospatial-modeling-course/resources/mitas_mitasova_1999_2005.pdf"> Table 1</a> 
  <li class="fragment">see the equations for selected $R(.)$ in the section 6.6.4 
  <a href="http://www.spatialanalysisonline.com/output/">here</a>
</ul>
</section>

<section>
   <h3>Regularized splines with tension (RST) </h3>
<p>
$$
F(r) = T(r) + ∑ λ_j R(\rho_j)  \;    j=1,m
$$
<ul>
<li>where $\rho =\varphi |r-r_j|$ 
<li>$\varphi$ is the tension parameter and 
<li>$|r-r_j|$ is the distance between the unsampled and measured points. 
</ul>
<p class="fragment">
Spline tension rescales distances, it has similar effect to shortening range in kriging 
or decreasing the distance weight exponent in IDW
<p class="fragment"><small>High tension stretches the distances making the sheet thinner and more flexible 
this shortens the range of influence of each point, so the range effect is inverse of tension</small> 
</section>

<section>
   <h3>Spline: tension</h3>
Tension controls the stiffness of the plate:
<ul> 
 <li> high tension: soft rubber sheet, short range 
 <li> low tension: stiff steel plate, long range 
</ul>
<p>
<img height="400" src="img/spatial_interpolation/tension.gif"> </p>
</section>

<section>
   <h3>Spline: tension</h3>
<p>
<img height="230" src="img/spatial_interpolation/spline_ten160_1mn.jpg"> 
<img height="230" src="img/spatial_interpolation/spline_ten40_1mn.jpg"> 
<img height="230" src="img/spatial_interpolation/spline_ten10_1mn.jpg"> 
<p><small>
High tension, short  range of influence, soft rubber sheet, rough surface, peak or pit in each data point
<br>
Low tension, long range of influence, stiffer steel plate, smoother surface, possible overshoots.
<br>Note that tension is inverse of stiffness
</small>
</section>

<section>
   <h3>Spline: smoothing</h3>
<p> Allows the surface to deviate from measured points
<p>
$$F(x_i,y_i) = z(x_i, y_i) + \varepsilon(x_i,y_i)$$ 
<p>
<img height="280" src="img/spatial_interpolation/spline_smooth_springs.png"> 
<p>Reduces overshoots, noise, improves numerical stability
<br>Can be applied to individual points for data with different accuracies.
<p><small>Example: lidar bare earth data: low smoothing for open areas, high smoothing for forest</small>
</section>

<section>
   <h3>Spline: smoothing</h3>
<p>
Smoothing controls the deviation from the data points, large smoothing results in trend surface $T(x,y)$
<p>
<img height="400" src="img/spatial_interpolation/smooth.gif"> </p>
</section>

<section>
   <h3>Spline: smoothing</h3>
Smoothing can be spatially variable 
<p>
<img height="400" src="img/spatial_interpolation/spline_ten40_1mn.jpg"> </p>
<img height="400" src="img/spatial_interpolation/spline_smoothvar_1mn.jpg"> </p>
</section>

<section>
   <h3>Spline interpolation from points</h3>
<ul>
  <li>Spline with tension: numerical solution supports carved streams, but here the 
tension is too high
  <li>RST method lower tension combined with smoothing reduce bias towards given points
</ul>
<p>
<img height="300" src="img/spatial_interpolation/InttopogrF1e.gif">
<img height="300" src="img/spatial_interpolation/IntRSTF1f.gif"> </p>
<p>Note that tension is inverse of stiffness
<p class="credit">Figure from
<a href="http://fatra.cnr.ncsu.edu/~hmitaso/gmslab/papers/mitas_mitasova_1999_2005.pdf">Mitas, L., Mitasova, H., 1999, Spatial Interpolation. In: P.Longley, M.F. Goodchild, D.J. Maguire, D.W.Rhind (Eds.), GIS: Principles, Techniques, Management and Applications, GeoInformation International, Wiley, 481-492.</a></p>
</section>

<section>
   <h3>Spline interpolation from contours</h3>
If the density of points along contours is high, spline with high tension leads 
to sUrface with steps along contours, point reduction and lower tension improves the result
<p>
<img height="400" src="img/spatial_interpolation/spline_from_contours.png"> </p>
</section>

<section>
   <h3>Interpolation with anisotropy</h3>
Anisotropic tension: rescaling distances in a given direction making the range of influence different in this direction, leading to anisotropic pattern in the resulting surface
<p>
<img height="400" src="img/spatial_interpolation/spline_anisotr_streamHK.png"> </p>
</section>

<section>
   <h3>Interpolation from profiles</h3>
RTK GPS or single beam sonar use automated dense sampling along a line 
– anisotropy can be used to rescale distances between profiles and minimize artifacts
<p>
<img height="400" src="img/spatial_interpolation/spline_anisotr_beachprofiles.jpg"> </p>
<p class="fragment" >Better alternative is to map it with a drone using structure from motion
</section>

<section>
   <h3>Interpolation accuracy</h3>
<p>
Effect of smoothing: measured by deviations from given points
$$
dz (x,y) = z' (x,y) – z (x,y)
$$
<small>where $z'$ is the interpolated value and $z$ is the given value </small>
<p>
Predictive accuracy: measured by crossvalidation error
$$e_z (x,y) = z' (x,y) – z_o (x,y)$$
<small>where $z'$ is the interpolated and $z_o$ is the given value in a point that was omitted 
from the set of points used for the interpolation. 
n-interpolations are performed, each time omitting one point in which $e_z$ is computed: 
also called 
<a href="http://en.wikipedia.org/wiki/Cross-validation_(statistics)">
leave-one-out cross-validation (LOOCV)</a>
</small>
<p>
Artifacts, bias can be found using histograms, aspect maps, curvatures
</section>

<section>
   <h3>Interpolated surface deviations </h3>
Deviations map for smoothing 0.1 and 10
<p>
<img height="400" src="img/spatial_interpolation/devism01_3d.jpg"> 
<img height="400" src="img/spatial_interpolation/devism10_3d.jpg"> </p>
</section>

<section>
   <h3>Interpolated surface predictive errors </h3>
Map showing spatial pattern of predictive errors 
<p>
<img height="400" src="img/spatial_interpolation/crossval2d.png"> 
<img height="400" src="img/spatial_interpolation/crossval3d.jpg"> </p>
</section>

<section>
   <h3>Trivariate Interpolation</h3>
Given $m$ points measured in 3D space, find such $F(x,y,z$) that for each $i=1,m$
$$
    w_i=F(x_i,y_i,z_i)              
$$
and compute $w_k=F(x_k,y_k,z_k)$ in 3D grid points
<p>
Similarly for 4D space (3D + time): $w_i=F(x_i,y_i,z_i,t_i)$
<p class="fragment" >
Supported by specialized software for geostatistics: radial basis functions and splines. 
3D spline is available in GRASS GIS   
</section>

<section>
   <h3>Trivariate Interpolation: volume</h3>
Nitrogen concentrations $w_i$ in the Chesapeake Bay sampled at points $(x_i,y_i,z_i)$ 
with different depths
<p>
<img height="360" src="img/spatial_interpolation/chesapsites.jpg">
<img height="360" src="img/spatial_interpolation/chesap_midtens.jpg"> 
<img height="280" src="img/spatial_interpolation/chesaplg.gif"> </p>
</section>

<section>
   <h3>Trivariate Interpolation: tension</h3>
Impact of tension on the volume model: high to low tension
<p>
<img height="300" src="img/spatial_interpolation/chesap_hightens.jpg"> 
<img height="300" src="img/spatial_interpolation/chesap_midtens.jpg"> 
<img height="300" src="img/spatial_interpolation/chesap_lowtens.jpg"> </p>
<p class="fragment"><small>High tension: local max or min at given points, low tension: smooth pattern 
with potential "overshoots" </small>
</section>

<section>
   <h3>Trivariate Interpolation to 2D grid</h3>
<ul>
 <li>Interpolation of a variable to 2D grid with influence of a third variable
 <li>Given $m$ points $(x_i,y_i,z_i,w_i)$  where $z_i = F_1 (x_i,y_i)$ 
find such $F_2(x,y,z)$ that for each $i=1,m$
$$
    w_i=F_2(x_i,y_i,z_i)
$$
 <li> then compute $w_k=F_3(x_k,y_k)$ at $F_1 \cap F_2$
</ul>
<p class="fragment" ><small>
Example: $w_i$ is precipitation measured at locations $x_i,y_i$ at near-ground elevation $z_i$.
F_1 is represented by a DEM, F_2 is an interpolated precipitation volume (voxel model) 
that passes through the points $(x_i,y_i,z_i,w_i)$. $F_3$ is a bivariate function represented
as a 2D precipitation grid which is an intersection of a DEM and the interpolated precipitation volume F_2
</small>
<p class="fragment" ><small>Statistical approach of the method is given by Hutchinson
and has been used to interpolate global climate maps (add ref and verify)</small>
</section>

<section>
   <h3>Trivariate Interpolation: precipitation</h3>
NC mean annual precipitation with zoom into Western NC: 
compare bivariate interpolation and trivariate interpolation which includes influence of elevation
<p> 
<img height="350" src="img/spatial_interpolation/spline_trivar_NCprecip.jpg">
<p class="fragment"><small>If sufficient data are available, the method captures increase of precipitation
with elevation around Asheville and decrease of precipitation with elevation on the border with SC
</small>
</section>

<section>
   <h3>Trivariate Interpolation: precipitation</h3>
Tropical South America mean annual precipitation using bivariate and trivariate interpolation
<p> 
<img height="350" src="img/spatial_interpolation/xmsap2d.gif">
<img height="350" src="img/spatial_interpolation/xmsapel.gif">
<img height="250" src="img/spatial_interpolation/preciplg.jpg"> </p>
</section>

<section>
   <h3>Trivariate Interpolation: precipitation</h3>
<p> 
Tuning the influence of elevation on precipitation pattern through rescaling in the $z$-direction
<img height="380" src="img/spatial_interpolation/sapel.gif">
</section>

<section>
   <h3>Local function implementation</h3>
<ul>
 <li class="fragment">Only points within the range of influence are needed for interpolation:
 <li class="fragment">Local search (IDW, geostatistics, some implementations of splines and RBF)– no continuity condition, overlap
 <li class="fragment">nearest $n$-points
 <li class="fragment">all points within $d$-distance
 <li class="fragment">modifications: n-points from each quadrant or increase $d$ until at least $n$-points are found
 <li class="fragment">TIN, natural neighbor use vertices of triangles or voronoi polygons, additional neighboring 
triangles or polygons for non-linear interpolation
</ul>
</section>

<section>
   <h3>Interpolation points selection </h3>
<ul>
  <li class="fragment">each grid point is interpolated by an independent function
  <li class="fragment">points overlap ensures continuity 
  <li class="fragment">resolution should be close to the distances of input points
</ul>
<p class="fragment">
<img height="350" src="img/spatial_interpolation/idw_pointselect.png">
<img height="350" src="img/spatial_interpolation/interp_localpointsearch.png">
<img height="350" src="img/spatial_interpolation/interp_localpointsearch_contour.png">
<p class="fragment"><small>Problems arise when points are clustered, for example all points are from the same contour
- bias, waves</small>
</section>

<section>
   <h3>Quadtree segmentation </h3>
<ul>
<li class="fragment">each rectangular segment has approximately same number of measured points (segmax)
<li class="fragment">each segment has many grid points – many grid points are interpolated by the same function as opposed to local point selection 
<li class="fragment">interpolation is performed using the points in the segment and its neighbourhood defined by a dynamic window (npmin)
</ul>
</section>

<section>
   <h3>Quadtree segmentation </h3>
<p> Problems when the data are too dense along a line can still be there
<img height="350" src="img/spatial_interpolation/quadtreeseg.png">
<img height="350" src="img/spatial_interpolation/quadtreecont.png">
<p>Dynamic search window is used to find overlapping points to ensure smooth connection of segments
</section>

<section>
   <h3>Summary</h3>
</section>

<div class="parent-page">
    <!-- &#x1f3e0; -->
    <a href="http://ncsu-geoforall-lab.github.io/geospatial-modeling-course/" title="Go to the course page">&#8962;</a>
</div>
