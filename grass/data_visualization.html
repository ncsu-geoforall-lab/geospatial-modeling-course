<h2>Data display and visualization</h2>
<p>Resources:
<ul>
<li><a href="http://grass.osgeo.org/grass70/manuals/index.html">
GRASS GIS overview and manual</a></li>
<li> <a href="data_acquisition.html#commands">Recommendations</a>
and <a href="http://www4.ncsu.edu/~akratoc/GRASS_intro/">tutorial</a>
how to use wxGUI from the first assignment</li>
<li>Screen captures for 3D visualization with wxnviz in GRASS6.4.3RC2 (similar to GRASS7)
<ul>
<li><a href="http://courses.ncsu.edu/mea582/common/media/03/sc_wxnviz1_edit1large.mov"> Visualization in GRASS I: surface (71MB)</a></li>
<li><a href="http://courses.ncsu.edu/mea582/common/media/03/sc_wxnviz2_edit2.mov"> Visualization in GRASS II: draping points and lines (45MB)</a></li>
<li><a href="http://courses.ncsu.edu/mea582/common/media/03/sc_wxnviz3_edit.mov"> Visualization in GRASS III: cutting planes (62MB)</a></li>
</ul></li>
</ul>


<h3>Start GRASS GIS</h3>
In startup pannel set <b>GIS Data Directory</b> to path to datasets,
for example on MS Windows, <code>C:\Users\myname\grassdata</code>.
For <b>Project location</b> select nc_spm_08_grass7 (North Carolina, State Plane, meters) and
for <b>Accessible mapset</b> create a new mapset (called e.g. HW_data_visualization) and
click <b>Start GRASS</b>.

<pre><code>
grass70
</code></pre>


<h3>Changing the default font</h3>

Change the default font used for map rendering, use:
<em>Settings</em> > <em>Preferences</em> > <em>Map Display</em>.
Pick a new default font and <em>Save</em> the settings.


<h3>Visualization in 3D perspective</h3>

<!-- p. 273-280 in GRASSbook<br> -->
Set the region to the raster "elevation".

<pre><code>
g.region raster=elevation -p <!--nviz elevation vector=roadsmajor point=schools_wake-->
</code></pre>

<p>
Interactively view "elevation" raster and vector data ("streams", "usgsgages") in 3D view,
adjust viewing position, surface properties and lighting to highlight features.
<p>
Remove or switch off any map layers in the Layer Manager.
Then add raster "elevation", Add vector "streams", Add vector "usgsgages".<br>
Zoom to computational region and Switch to 3D view.<br>
<p>
Follow the video Visualization I and II for similar tasks (link is above) and
save 2-3 images for your report
(save as tiff or take screenshot, if you don't have tiff support).

<h4>Visualizing multiple surfaces</h4>
Visualize multiple surfaces (bare earth and surface with vegetation and structures),<br>
analyze their relationship using crossections generated by interactive cutting planes<br>
<p>
It is recommended to quit GRASS before starting the task below
because we will be working with a smaller, high resolution region.
<p>
Start GRASS7 with your previous MAPSET.
First set region to "rural_1m", then interpolate surface with vegetation
from multiple return lidar points using the module <em class="module">v.surf.rst</em>
(we will explain interpolation later on).

<pre><code>
g.region rural_1m -p
v.surf.rst elev_lidrural_mrpts elevation=elev_lidruralmr_1m npmin=120 segmax=25 tension=40 smooth=1.0
</code></pre>

<p>
In Layer Manager Add rasters "elev_lidruralmr_1m" and "elev_lid792_1m" (bare earth).
In Map Display <em>Zoom to computational region</em>.
<p>
Make sure that you have only the two elevation maps switched on in the Layer Manager.
Switch to 3D view and follow the video Visualization III (link is above).
Save 2-3 interesting images for your report, include at least one crossection.
<!--nviz elev_lidruralmr_1m,elev_lid792_1m-->

<h3>Basic 2D display operations</h3>
GUI is recommended for the tasks below,
see the GUI equivalents for selected d* commands above,
the command line is to indicate the workflow and output.

<!-- p. 84-85<br> -->
<h4>Display subsets of data</h4>
Visualy explore relation between developed areas and topography.
<p>
Display land use categories 1, 2 (developed land) over shaded topography.<br>
<em>Settings</em> > <em>Region</em> > <em>Set region</em> > <em>Set region to match this raster</em> > select "landuse96_28m".<br>
<em>Add raster</em> > select "elevation_shade".<br>
<em>Add raster</em> > select "landuse96_28m" > <em>Selection</em> > <em>List of cats to display</em> > 1,2.<br>
<em>Zoom to computational region</em>.<br>
Right click on "landuse96_28m" map layer and <em>Change opacity</em> to show topography blended with landuse.
Save display to graphic file.
You may want to remove all previously used layers from the <em>Layer Manager</em>
before you start visualizing the new ones.

<pre><code>
g.region raster=landuse96_28m -p
<!-- d.erase -->
d.rast elevation_shade
d.rast landuse96_28m values=1,2
d.out.file landuse_elev
</code></pre>

<!--
<font color="#000066">
# Following the example above
# display elevations with values within intervals <50,80> and <120,160> over geology
# elevation is continuous field map, so we use val instead of cat for Selection
# set opacity level for the elevation to 50% to see the underlying geology
</font>
d.rast geology_30m
d.rast elevation val=50-80,120-160 -o
-->
<h4>Change colors for raster maps</h4>
There are many ways how to do it see <em class="module">r.colors</em> manual).
<p>
First create your own copy of the elevation map (see the command below).<br>
Display it by Add raster > "myelev".

<pre><code>
g.copy raster=elevation,myelev
d.rast myelev
</code></pre>

<p>
Set the color table to a predefined one, for example "bgyr" (blue, green, yellow, red).
<p>
GUI options: Right Click on the raster layer "myelev" in Layer Manager > <em>Set color table</em> > <em>Define</em> > <em>Name of color table</em> > "bgyr" > <em>Run</em>.<br>
If you don't see the new colors - click the second button in Map Display to redraw.

<pre><code>
r.colors myelev color=bgyr
d.rast myelev
</code></pre>

<p>
Change the color table interactively using rules:
<p>
In the Layer Manager manu click <em>Raster</em> > <em>Manage colors</em> > <em>Manage Color rules interactively</em>.<br>
Select raster map "myelev".<br>
Click on colored squares to change the color, click <em>Preview</em>.<br>
If it looks good - click OK.
<p>
To create color table for future multiple uses
type the rules into a plain text mycolor.txt file
using a text editor (TextEdit, Notepad), for example:

<pre data-filename="mycolor.txt">
50 blue
70 aqua
90 green
110 yellow
130 orange
160 brown
</pre>

<p>
Then assign it as follows:<br>
Right click on "myelev" map layer > <em>set color table</em> > <em>Define</em> > <em>Path to rules file</em> > <em>Run</em>.<br>
If needed, redraw using the second button on Map Display.
You can also create and assign the above color table by typing or pasting it into the
<em>enter values interactively</em> window
or run it from comand line (make sure you have the correct path,
in the following example <code>mycolor.txt</code> should be replaced
by e.g. /Users/john/mycolor.txt on Mac OS X):

<pre><code>
r.colors myelev rules=mycolor.txt
</code></pre>

<p>
Note that you can combine color RGB and name definitions
as well as % and cat/val to create complex custom color tables
and store them in a text file for future use, see the examples in <em class="module">r.colors</em> man page.

<h4>Compare the use of equal interval and histogram equalized color table for slope</h4>

To add the legend use <em>Add map elements</em> button on Map Display.

<pre><code>
g.copy raster=slope,myslope
r.colors myslope color=bgyr
d.rast myslope
d.legend myslope
d.out.file myslopecolor
</code></pre>

<p>
To explain the difference between the two maps, you can generate a histogram.
On map Display click on <em>Analyze map</em> > <em>Create histogram</em> to open the histogram tool and
save results to graphics file. Or use this command which will
add a histogram as a layer to Layer Manager.
<pre><code>
d.histogram myslope
</code></pre>
<p>
Now set the histogram equalized color table, and save the new slope map and histogram images.
<span class="question">Describe the effect of the histogram equalized color table.</span>
<pre><code>
r.colors -e myslope color=bgyr
d.out.file myslopecolorequalized
d.histogram myslope
</code></pre>

<h3>Modify legend, scale and grid</h3>
To re-size the legend for myslope, right click on the legend,
select Resize legend and resize with mouse.
Alternatively you can resize by selecting <em>Pointer</em> mode in Map Display, double clicking on legend to launch the legend dialog
and set options > <em>Optional</em> > <em>Placement</em> > 50,90,4,7.<br>
Numbers are bottom,top,left,right as percentage of screen coordinates.<br>
Add units to the legend: <em>Add map elements</em> > <em>Add text layer</em> > type deg > OK.<br>
Add barscale on Map Display: <em>Add map elements</em> > <em>Show/hide north arrow</em> (double click on it to change it).<br>
<p>
Note: you can use horizontal legends by using Placement at=6,10,2,30
or just stretch it horizontally with mouse.

<pre><code>
d.barscale
d.legend myslope at=50,90,4,7
</code></pre>

<p>
Switch off "myslope", display "myelev" raster and change the legend to "myelev" raster.
Add grid for state plane coordinates at 5000m with ticks at 1000m.
Also add a lat/long grid at 2 arc minute interval.
<p>
In Layer Manager > <em>Add various overlays</em> > <em>Add grid layer</em> > Size 5000 > Run.<br>
To draw only border with ticks: change Size to 1000 and click <em>Disable</em> > <em>Disable grid drawing</em> > Run.<br>
Switch off <em>Disable grid drawing</em>.<br>
To draw lat/long grid: set <em>Required</em> > Size to 0:02 > click <em>Draw</em> > <em>Draw geographic grid</em> > Run.<br>
Command line alternative:

<pre><code>
d.rast myelev
d.legend myelev
d.grid size=5000 color=brown
d.grid -n size=1000
d.grid -g size=0:02 color=black
d.out.file myelevmap
</code></pre>

<h3>Display color composite</h3>
In Layer Manager: <em>Add various raster map layers</em> > <em>Add RGBmap layer</em>.<br>

<pre><code>
d.rgb red=lsat7_2002_30 green=lsat7_2002_20 blue=lsat7_2002_10
d.vect roadsmajor color=yellow
d.out.file mylandsat
</code></pre>

<h3>Export NC precipitation stations data to kml and post in Google Earth</h3>
If your are running the command in GUI do not forget to click point for data type.
To view the data in Google Earth just drag and drop the kml file in the Google Earth window.

<pre><code>
g.region nc_500m
v.out.ogr precip_30ynormals output=c:\temp\precipitation.kml format=KML type=point
</code></pre>

<h3>Optional part</h3>

<h4>Add WMS layer</h4>
View and download orthophoto through web mapping service.
Requires good internet connection. If it doesn't work, report the problem
including any error message in the report.<br>
First change region to the small rural area and display the provided orthophoto.

<pre><code>
g.region rural_1m -p
d.rast ortho_2001_t792_1m
</code></pre>

<p>
In Layer Manager toolbar <em>Add web service layer</em>.<br>
Paste the link to the service into server field and press connect:<br>
<pre>
http://raster.nationalmap.gov/arcgis/services/Orthoimagery/USGS_EROS_Ortho_1Foot/ImageServer/WMSServer?
</pre>
Wait until GUI changes.<br>
In list of layers, there should be "Orthoimagery_All", click on that.<br>
Press Add layer button and wait.<br>
The dialog can be closed afterwards.<br>
<p>
To save the layer:<br>
Right click on the web service layer in Layer Manager - choose <em>Save web service layer</em>.
In dialog, set the name of the layer ortho_new and press <em>Save layer</em>.<br>

<h4>Map Swipe</h4>
Use mapswipe to compare the new orthophoto with the ortho provided in the data set:<br>
<em>File</em> > <em>Map Swipe</em>.<br>
Add raster > select "ortho_2001_t792_1m" and "ortho_new".<br>
<p>
Move slider to compare images - what changes do you observe?
Save a screenshot of the mapswipe window showing the comparison of orthos.
See more options <a href="http://grasswiki.osgeo.org/wiki/WxGUI_Map_Swipe">here</a>.

<p>
<!--
<font color="#000066">
# Set color scheme for vector data, display vector data attributes
</font>
g.region raster=elevation -p
g.copy vect=streets_wake,mystreets
v.colors mystreets column=SPEED color=rainbow
d.vect -a mystreets
#
# if the above does not work try this
#
v.db.addcol map=mystreets columns="myrgb varchar(11)"
v.colors mystreets column=SPEED color=rainbow rgb_column=myrgb
d.vect -a mystreets rgb_column=myrgb

<font color="#000066">
# Export data to kml and post in Google Earth# If your are running the command in GUI do not forget to click point for data type
# To view the data in Google Earth just drag and drop the kml file in the Google Earth window
</font>
g.region nc_500m
v.out.ogr precip_30ynormals dsn=c:\temp\precipitation.kml format=KML type=point


<font color="#000066">
# Draw thematic vector map showing number of children 10-14 in census blocks and school capacity
# In GIS Layer Manager Add various vector maps > Add thematic layer
# Tab Required > censusblk_swwake, Feature type > area, Name of attribute> P10_TO_14,
# Type of display>graduated_colors, Thematic divisions>interval, Color scheme > yellow-cyan
# Tab Theme > Number of classes > 12, OK
#
# In GIS Layer Manager Add various vector maps > Add thematic layer
# Required > schools_wake, Feature type > point, Name of attribute> CORECAPACI,
# Type of display>graduated_points, Thematic divisions>interval
# Theme > Number of classes > 10
# Points > Icon size > 3, Max icon size > 30
</font>
d.vect.thematic -gs map=censusblk_swwake type=area column=P10_TO_14 themetype=graduated_colors nint=15 colorscheme=yellow-cyan
d.vect.thematic -gs map=schools_wake type=point column=CORECAPACI themetype=graduated_points size=3 maxsize=30 nint=10 colorscheme=blue-red
v.colors mycensus column=P10_TO_14 color=bcyr

<font color="#000066">
# derive RGB channels from hue and intensity
# save shaded map with basins as a single raster layer
</font>
g.region raster=elevation -p
r.his h=basin_50K i=elevation_shade b=el_b g=el_g r=el_r
<font color="#000066">
# create a single composite map
</font>
r.composite b=el_b g=el_g r=el_r out=basins_shaded_10m
d.rast basins_shaded_10m
-->
